import eventlet
import socketio

sio = socketio.Server()
app = socketio.WSGIApp(sio, static_files={
    '/': {'content_type': 'text/html', 'filename': 'index.html'}
})

app = socketio.Middleware(sio, app)


def send_control(steering_angle, throttle):
    sio.emit(
        "control",
        data={
            "next_x": [
                909.481999165313,
                909.48599749594,
                909.491994991881,
                909.499991653134,
                909.509987479702,
                909.521982471582,
                909.535976628776,
                909.551969951284,
                909.569962439104,
                909.589954092239,
                909.611944910687,
                909.635934894448,
                909.661924043522,
                909.68991235791,
                909.719899837612,
                909.751886482627,
                909.785872292955,
                909.821857268597,
                909.859841409552,
                909.899824715821,
                909.941807187403,
                909.985788824298,
                910.031769626507,
                910.07974959403,
                910.129728726865,
                910.181707025015,
                910.235684488477,
                910.291661117254,
                910.349636911343,
                910.409611870746,
                910.471585995462,
                910.535559285492,
                910.601531740835,
                910.669503361492,
                910.739474147462,
                910.811444098746,
                910.885413215343,
                910.961381497253,
                911.039348944477,
                911.119315557014,
                911.201281334865,
                911.285246278029,
                911.371210386507,
                911.459173660298,
                911.549136099402,
                911.64109770382,
                911.735058473551,
                911.831018408596,
                911.928977508954
            ],
            "next_y": [
                1128.67000084601,
                1128.67000255321,
                1128.67000515195,
                1128.67000868782,
                1128.67001322159,
                1128.67001882931,
                1128.67002560232,
                1128.67003364728,
                1128.67004308627,
                1128.67005405679,
                1128.67006671188,
                1128.67008122017,
                1128.67009776598,
                1128.67011654937,
                1128.6701377863,
                1128.67016170868,
                1128.67018856453,
                1128.67021861808,
                1128.67025214986,
                1128.67028945693,
                1128.67033085293,
                1128.67037666829,
                1128.67042725036,
                1128.67048296359,
                1128.67054418971,
                1128.6706113279,
                1128.67068479496,
                1128.67076502557,
                1128.67085247242,
                1128.67094760648,
                1128.67105091719,
                1128.67116291269,
                1128.67128412007,
                1128.6714150856,
                1128.67155637497,
                1128.67170857357,
                1128.67187228676,
                1128.67204814011,
                1128.6722367797,
                1128.67243887242,
                1128.67265510625,
                1128.67288619056,
                1128.67313285644,
                1128.67339585699,
                1128.67367596768,
                1128.67397398667,
                1128.67429073511,
                1128.67462705758,
                1128.67498382235
            ]
        },
        skip_sid=False)


@sio.event
def connect(sid, environ):
    print('connect ', sid)


@sio.event
def telemetry(sid, data):
    print(data)
    send_control(0.5, 0.5)


@sio.event
def disconnect(sid):
    print('disconnect ', sid)


if __name__ == '__main__':
    eventlet.wsgi.server(eventlet.listen(('', 4567)), app)
